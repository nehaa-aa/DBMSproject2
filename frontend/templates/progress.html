{% extends "base.html" %}
{% block title %}Progress Tracking ‚Äî Smart Nutrition{% endblock %}
{% block content %}
<div class="progress-container">
  <div class="page-header">
    <div class="header-content">
      <h2>üìà Your Health Progress</h2>
      <p class="page-subtitle">Track your BMI trends, calorie intake, and get personalized predictions</p>
    </div>
    <div class="header-actions">
      <button class="btn-export" onclick="exportProgress()">
        üìä Export Data
      </button>
      <a href="/profile" class="btn-update">
        ‚öñÔ∏è Update Biometrics
      </a>
    </div>
  </div>

  <!-- Quick Stats Overview -->
  {% if current_bio %}
  <div class="quick-stats-grid">
    <div class="stat-card weight">
      <div class="stat-icon">‚öñÔ∏è</div>
      <div class="stat-info">
        <span class="stat-label">Current Weight</span>
        <span class="stat-value">{{ current_bio.weight_kg }}<span class="unit">kg</span></span>
        <span class="stat-change positive">‚Üì 0.5kg this week</span>
      </div>
    </div>
    
    <div class="stat-card bmi">
      <div class="stat-icon">üìä</div>
      <div class="stat-info">
        <span class="stat-label">BMI</span>
        <span class="stat-value bmi-value">{{ current_bio.bmi }}</span>
        <span class="stat-status">
          {% if current_bio.bmi < 18.5 %}
            Underweight
          {% elif current_bio.bmi < 25 %}
            Normal
          {% elif current_bio.bmi < 30 %}
            Overweight
          {% else %}
            Obese
          {% endif %}
        </span>
      </div>
    </div>
    
    <div class="stat-card goal">
      <div class="stat-icon">üéØ</div>
      <div class="stat-info">
        <span class="stat-label">Goal</span>
        <span class="stat-value">{{ current_bio.goal|capitalize }}</span>
        {% if current_bio.target_weight_kg %}
        <span class="stat-target">Target: {{ current_bio.target_weight_kg }}kg</span>
        {% else %}
        <span class="stat-target">No target set</span>
        {% endif %}
      </div>
    </div>
    
    <div class="stat-card streak">
      <div class="stat-icon">üî•</div>
      <div class="stat-info">
        <span class="stat-label">Tracking Streak</span>
        <span class="stat-value" id="streakDays">0<span class="unit">days</span></span>
        <span class="stat-message">Keep it up!</span>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- BMI Prediction Card with Enhanced UI -->
  <div class="card prediction-card">
    <div class="card-header">
      <div class="header-left">
        <h3>üîÆ BMI Prediction & Trend Analysis</h3>
        <p class="muted">AI-powered predictions based on your historical data</p>
      </div>
      <div class="confidence-badge" id="confidenceBadge">
        <span class="badge-label">Confidence</span>
        <span class="badge-value">--</span>
      </div>
    </div>
    <div id="prediction-container">
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Analyzing your data...</p>
      </div>
    </div>
  </div>

  <!-- Charts Section with Tabs -->
  <div class="card charts-card">
    <div class="tabs-container">
      <!--<button class="tab-btn active" data-tab="bmi">üìä BMI & Weight</button>
      <button class="tab-btn" data-tab="calories">üî• Calories</button>-->
      <button class="tab-btn" data-tab="nutrition">ü•ó Nutrition</button>
    </div>

    <!-- BMI Chart Tab -->
     <!--
    <div class="tab-content active" data-tab="bmi">
      <div class="chart-header">
        <h3>BMI & Weight Trend</h3>
        <div class="chart-controls">
          <button class="btn-chart-range active" data-chart="bmi" data-days="30">30D</button>
          <button class="btn-chart-range" data-chart="bmi" data-days="60">60D</button>
          <button class="btn-chart-range" data-chart="bmi" data-days="90">90D</button>
          <button class="btn-chart-range" data-chart="bmi" data-days="180">6M</button>
        </div>
      </div>
      <div class="chart-wrapper">
        <canvas id="bmiChart"></canvas>
      </div>
      <div class="chart-insights" id="bmiInsights">
        <div class="insight-item">
          <span class="insight-icon">üìâ</span>
          <span class="insight-text">Loading insights...</span>
        </div>
      </div>
    </div>

     Calorie Chart Tab 
    <div class="tab-content" data-tab="calories">
      <div class="chart-header">
        <h3>Daily Calorie Intake</h3>
        <div class="chart-controls">
          <button class="btn-chart-range active" data-chart="calories" data-days="7">7D</button>
          <button class="btn-chart-range" data-chart="calories" data-days="14">14D</button>
          <button class="btn-chart-range" data-chart="calories" data-days="30">30D</button>
          <button class="btn-chart-range" data-chart="calories" data-days="90">90D</button>
        </div>
      </div>
      <div class="chart-wrapper">
        <canvas id="calorieChart"></canvas>
      </div>
      <div class="chart-insights" id="calorieInsights">
        <div class="insight-item">
          <span class="insight-icon">üî•</span>
          <span class="insight-text">Loading insights...</span>
        </div>
      </div>
    </div> -->

    <!-- Nutrition Tab -->
    <div class="tab-content" data-tab="nutrition">
      {% if nutrition_balance %}
      <div class="nutrition-overview">
        <h3>Nutritional Balance (Last 7 Days)</h3>
        <p class="muted">Your macronutrient distribution and intake</p>
      </div>
      
      <div class="macro-visualization">
        <div class="macro-chart-container">
          <canvas id="macroChart"></canvas>
        </div>
        <div class="macro-details">
          <div class="macro-item protein">
            <div class="macro-header">
              <span class="macro-icon">ü•©</span>
              <span class="macro-name">Protein</span>
              <span class="macro-value">{{ nutrition_balance.total_protein|round(1) }}g</span>
            </div>
            <div class="macro-bar">
              {% set protein_pct = ((nutrition_balance.total_protein / 500 * 100)|round(1)) %}
              <div class="macro-fill" style="width: {{ [protein_pct, 100]|min }}%"></div>
            </div>
            <span class="macro-target">Target: 500g/week</span>
          </div>
          
          <div class="macro-item carbs">
            <div class="macro-header">
              <span class="macro-icon">üçû</span>
              <span class="macro-name">Carbohydrates</span>
              <span class="macro-value">{{ nutrition_balance.total_carbs|round(1) }}g</span>
            </div>
            <div class="macro-bar">
              {% set carbs_pct = ((nutrition_balance.total_carbs / 1500 * 100)|round(1)) %}
              <div class="macro-fill" style="width: {{ [carbs_pct, 100]|min }}%"></div>
            </div>
            <span class="macro-target">Target: 1500g/week</span>
          </div>
          
          <div class="macro-item fats">
            <div class="macro-header">
              <span class="macro-icon">ü•ë</span>
              <span class="macro-name">Fats</span>
              <span class="macro-value">{{ nutrition_balance.total_fat|round(1) }}g</span>
            </div>
            <div class="macro-bar">
              {% set fats_pct = ((nutrition_balance.total_fat / 400 * 100)|round(1)) %}
              <div class="macro-fill" style="width: {{ [fats_pct, 100]|min }}%"></div>
            </div>
            <span class="macro-target">Target: 400g/week</span>
          </div>
        </div>
      </div>
      {% else %}
      <div class="empty-state-nutrition">
        <div class="empty-icon">ü•ó</div>
        <h4>No Nutrition Data</h4>
        <p>Start logging meals to see your nutritional breakdown</p>
        <a href="/meal" class="btn-primary">Log Your First Meal</a>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Progress Milestones -->
  <div class="card milestones-card">
    <div class="card-header">
      <h3>üèÜ Progress Milestones</h3>
      <p class="muted">Celebrate your achievements</p>
    </div>
    <div class="milestones-grid" id="milestonesGrid">
      <div class="milestone locked">
        <div class="milestone-icon">üéØ</div>
        <div class="milestone-info">
          <h4>First Week</h4>
          <p>Track for 7 consecutive days</p>
        </div>
        <div class="milestone-progress">3/7</div>
      </div>
      
      <div class="milestone unlocked">
        <div class="milestone-icon">üìù</div>
        <div class="milestone-info">
          <h4>First Entry</h4>
          <p>Log your first meal</p>
        </div>
        <div class="milestone-badge">‚úì</div>
      </div>
      
      <div class="milestone locked">
        <div class="milestone-icon">üí™</div>
        <div class="milestone-info">
          <h4>Goal Reached</h4>
          <p>Reach your target weight</p>
        </div>
        <div class="milestone-progress">--</div>
      </div>
      
      <div class="milestone locked">
        <div class="milestone-icon">üî•</div>
        <div class="milestone-info">
          <h4>30 Day Streak</h4>
          <p>Track for 30 days straight</p>
        </div>
        <div class="milestone-progress">--</div>
      </div>
    </div>
  </div>

  <!-- Weekly Summary -->
  <div class="card weekly-summary">
    <div class="card-header">
      <h3>üìÖ This Week's Summary</h3>
      <p class="muted">Your weekly progress at a glance</p>
    </div>
    <div class="summary-grid">
      <div class="summary-item">
        <div class="summary-metric">
          <span class="metric-label">Avg. Daily Calories</span>
          <span class="metric-value" id="avgCalories">--</span>
        </div>
      </div>
      <div class="summary-item">
        <div class="summary-metric">
          <span class="metric-label">Meals Logged</span>
          <span class="metric-value" id="mealsLogged">--</span>
        </div>
      </div>
      <div class="summary-item">
        <div class="summary-metric">
          <span class="metric-label">Weight Change</span>
          <span class="metric-value" id="weightChange">--</span>
        </div>
      </div>
      <div class="summary-item">
        <div class="summary-metric">
          <span class="metric-label">BMI Change</span>
          <span class="metric-value" id="bmiChange">--</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State (if no data) -->
  {% if not current_bio %}
  <div class="card empty-state">
    <div class="empty-icon">üìä</div>
    <h3>Start Tracking Your Progress</h3>
    <p>Add your biometrics to unlock personalized insights, predictions, and beautiful progress charts!</p>
    <a href="/profile" class="btn-primary btn-large">Add Biometrics Now</a>
  </div>
  {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
let bmiChart, calorieChart, macroChart;

// Tab switching
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    const tabName = this.dataset.tab;
    
    // Update buttons
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    
    // Update content
    document.querySelectorAll('.tab-content').forEach(content => {
      content.classList.remove('active');
    });
    document.querySelector(`.tab-content[data-tab="${tabName}"]`).classList.add('active');
  });
});

// Export functionality
function exportProgress() {
  alert('Export feature coming soon! You\'ll be able to download your progress data as PDF or CSV.');
}

// Fetch and display BMI prediction
async function loadPrediction() {
  try {
    const response = await fetch('/api/predict-bmi');
    const data = await response.json();
    
    if (data.error) {
      document.getElementById('prediction-container').innerHTML = 
        `<div class="empty-prediction">
          <div class="empty-icon">üîÆ</div>
          <h4>Not Enough Data Yet</h4>
          <p>${data.error}</p>
          <p class="tip">üí° Add biometric entries on different days to enable predictions</p>
        </div>`;
      return;
    }
    
    // Update confidence badge
    const confidenceBadge = document.getElementById('confidenceBadge');
    confidenceBadge.querySelector('.badge-value').textContent = data.confidence + '%';
    confidenceBadge.className = 'confidence-badge ' + 
      (data.confidence >= 80 ? 'high' : data.confidence >= 60 ? 'medium' : 'low');
    
    const trendEmoji = data.trend === 'gaining' ? 'üìà' : data.trend === 'losing' ? 'üìâ' : '‚û°Ô∏è';
    const trendClass = data.trend === 'gaining' ? 'gaining' : data.trend === 'losing' ? 'losing' : 'stable';
    
    let html = `
      <div class="prediction-summary">
        <div class="current-status">
          <div class="status-card">
            <div class="status-icon">‚öñÔ∏è</div>
            <div class="status-content">
              <span class="status-label">Current Weight</span>
              <span class="status-value">${data.current_weight} kg</span>
            </div>
          </div>
          <div class="status-card ${trendClass}">
            <div class="status-icon">${trendEmoji}</div>
            <div class="status-content">
              <span class="status-label">Weight Trend</span>
              <span class="status-value trend">${data.trend}</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="predictions-timeline">
        <h4>Future Predictions</h4>
        <div class="timeline-container">
    `;
    
    data.predictions.forEach((pred, index) => {
      const bmiClass = pred.bmi < 18.5 ? 'underweight' : 
                       pred.bmi < 25 ? 'normal' : 
                       pred.bmi < 30 ? 'overweight' : 'obese';
      html += `
        <div class="prediction-item ${bmiClass}" style="animation-delay: ${index * 0.1}s">
          <div class="prediction-header">
            <span class="pred-timeline">
              <span class="timeline-dot"></span>
              <span class="timeline-label">${pred.days} days</span>
            </span>
            <span class="pred-category ${bmiClass}">${bmiClass}</span>
          </div>
          <div class="prediction-body">
            <div class="pred-metric">
              <span class="pred-label">Weight</span>
              <span class="pred-value">${pred.weight} kg</span>
            </div>
            <div class="pred-metric">
              <span class="pred-label">BMI</span>
              <span class="pred-value">${pred.bmi}</span>
            </div>
          </div>
        </div>
      `;
    });
    
    html += `
        </div>
      </div>
      <div class="prediction-footer">
        <div class="footer-note">
          <span class="note-icon">‚ÑπÔ∏è</span>
          <span>Predictions based on <strong>${data.data_points} data points</strong>. Add more entries for better accuracy!</span>
        </div>
      </div>
    `;
    
    document.getElementById('prediction-container').innerHTML = html;
  } catch (error) {
    console.error('Error loading prediction:', error);
    document.getElementById('prediction-container').innerHTML = 
      '<div class="empty-prediction"><p class="muted">Unable to load predictions</p></div>';
  }
}

// Load BMI trend chart
async function loadBMIChart(days = 30) {
  try {
    const response = await fetch(`/api/bmi-trend?days=${days}`);
    const data = await response.json();
    
    if (!data || data.length === 0) {
      document.querySelector('.chart-wrapper canvas#bmiChart').parentElement.innerHTML = 
        '<div class="empty-chart"><p class="muted">No BMI data available for this period</p></div>';
      return;
    }
    
    const ctx = document.getElementById('bmiChart');
    
    if (bmiChart) {
      bmiChart.destroy();
    }
    
    // Calculate insights
    const weights = data.map(d => d.weight_kg);
    const weightChange = weights[weights.length - 1] - weights[0];
    const avgWeight = weights.reduce((a, b) => a + b, 0) / weights.length;
    
    document.getElementById('bmiInsights').innerHTML = `
      <div class="insight-item">
        <span class="insight-icon">${weightChange < 0 ? 'üìâ' : weightChange > 0 ? 'üìà' : '‚û°Ô∏è'}</span>
        <span class="insight-text">
          Weight ${weightChange < 0 ? 'decreased' : weightChange > 0 ? 'increased' : 'stable'} by 
          <strong>${Math.abs(weightChange).toFixed(1)}kg</strong> in ${days} days
        </span>
      </div>
      <div class="insight-item">
        <span class="insight-icon">üìä</span>
        <span class="insight-text">Average weight: <strong>${avgWeight.toFixed(1)}kg</strong></span>
      </div>
    `;
    
    bmiChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: data.map(d => new Date(d.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })),
        datasets: [{
          label: 'Weight (kg)',
          data: data.map(d => d.weight_kg),
          borderColor: '#4f9df6',
          backgroundColor: 'rgba(79, 157, 246, 0.1)',
          tension: 0.4,
          fill: true,
          pointRadius: 4,
          pointHoverRadius: 6,
          yAxisID: 'y',
        }, {
          label: 'BMI',
          data: data.map(d => d.bmi),
          borderColor: '#22c55e',
          backgroundColor: 'rgba(34, 197, 94, 0.1)',
          tension: 0.4,
          fill: true,
          pointRadius: 4,
          pointHoverRadius: 6,
          yAxisID: 'y1',
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
          mode: 'index',
          intersect: false,
        },
        plugins: {
          legend: {
            display: true,
            position: 'top',
            labels: {
              usePointStyle: true,
              padding: 20
            }
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            padding: 12,
            borderRadius: 8,
            titleFont: {
              size: 14
            }
          }
        },
        scales: {
          y: {
            type: 'linear',
            display: true,
            position: 'left',
            title: {
              display: true,
              text: 'Weight (kg)',
              font: { size: 12, weight: 'bold' }
            },
            grid: {
              color: 'rgba(0, 0, 0, 0.05)'
            }
          },
          y1: {
            type: 'linear',
            display: true,
            position: 'right',
            title: {
              display: true,
              text: 'BMI',
              font: { size: 12, weight: 'bold' }
            },
            grid: {
              drawOnChartArea: false,
            }
          },
          x: {
            grid: {
              display: false
            }
          }
        }
      }
    });
  } catch (error) {
    console.error('Error loading BMI chart:', error);
  }
}

// Load calorie trend chart
async function loadCalorieChart(days = 7) {
  try {
    const response = await fetch(`/api/calorie-trend?days=${days}`);
    const data = await response.json();
    
    if (!data || data.length === 0) {
      document.querySelector('.chart-wrapper canvas#calorieChart').parentElement.innerHTML = 
        '<div class="empty-chart"><p class="muted">No calorie data available for this period</p></div>';
      return;
    }
    
    const ctx = document.getElementById('calorieChart');
    
    if (calorieChart) {
      calorieChart.destroy();
    }
    
    // Calculate insights
    const calories = data.map(d => d.total_calories);
    const avgCalories = calories.reduce((a, b) => a + b, 0) / calories.length;
    const maxCalories = Math.max(...calories);
    const minCalories = Math.min(...calories);
    
    document.getElementById('calorieInsights').innerHTML = `
      <div class="insight-item">
        <span class="insight-icon">üìä</span>
        <span class="insight-text">Average: <strong>${avgCalories.toFixed(0)} kcal/day</strong></span>
      </div>
      <div class="insight-item">
        <span class="insight-icon">‚¨ÜÔ∏è</span>
        <span class="insight-text">Highest: <strong>${maxCalories.toFixed(0)} kcal</strong></span>
      </div>
      <div class="insight-item">
        <span class="insight-icon">‚¨áÔ∏è</span>
        <span class="insight-text">Lowest: <strong>${minCalories.toFixed(0)} kcal</strong></span>
      </div>
    `;
    
    calorieChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: data.map(d => new Date(d.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })),
        datasets: [{
          label: 'Calories (kcal)',
          data: data.map(d => d.total_calories),
          backgroundColor: data.map(d => {
            const val = d.total_calories;
            if (val < 1500) return 'rgba(245, 158, 11, 0.6)';
            if (val < 2500) return 'rgba(34, 197, 94, 0.6)';
            return 'rgba(239, 68, 68, 0.6)';
          }),
          borderColor: data.map(d => {
            const val = d.total_calories;
            if (val < 1500) return '#f59e0b';
            if (val < 2500) return '#22c55e';
            return '#ef4444';
          }),
          borderWidth: 2,
          borderRadius: 8,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            padding: 12,
            borderRadius: 8
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Calories (kcal)',
              font: { size: 12, weight: 'bold' }
            },
            grid: {
              color: 'rgba(0, 0, 0, 0.05)'
            }
          },
          x: {
            grid: {
              display: false
            }
          }
        }
      }
    });
  } catch (error) {
    console.error('Error loading calorie chart:', error);
  }
}

// Load macro pie chart
function loadMacroChart() {
  {% if nutrition_balance %}
  const ctx = document.getElementById('macroChart');
  
  if (macroChart) {
    macroChart.destroy();
  }
  
  macroChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['Protein', 'Carbs', 'Fats'],
      datasets: [{
        data: [
          {{ nutrition_balance.total_protein|round(1) }},
          {{ nutrition_balance.total_carbs|round(1) }},
          {{ nutrition_balance.total_fat|round(1) }}
        ],
        backgroundColor: [
          'rgba(239, 68, 68, 0.8)',
          'rgba(245, 158, 11, 0.8)',
          'rgba(34, 197, 94, 0.8)'
        ],
        borderWidth: 3,
        borderColor: '#fff',
        hoverOffset: 10
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: {
          position: 'right',
          labels: {
            usePointStyle: true,
            padding: 20,
            font: {
              size: 14
            }
          }
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.8)',
          padding: 12,
          borderRadius: 8,
          callbacks: {
            label: function(context) {
              const label = context.label || '';
              const value = context.parsed;
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const percentage = ((value / total) * 100).toFixed(1);
              return `${label}: ${value}g (${percentage}%)`;
            }
          }
        }
      }
    }
  });
  {% endif %}
}

// Chart range buttons with unified handler
document.querySelectorAll('.btn-chart-range').forEach(btn => {
  btn.addEventListener('click', function() {
    const days = parseInt(this.dataset.days);
    const chartType = this.dataset.chart;
    
    // Remove active class from siblings in the same chart group
    const parentControls = this.closest('.chart-controls');
    parentControls.querySelectorAll('.btn-chart-range').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    
    if (chartType === 'bmi') {
      loadBMIChart(days);
    } else if (chartType === 'calories') {
      loadCalorieChart(days);
    }
  });
});

// Load weekly summary
async function loadWeeklySummary() {
  try {
    // This would call a new API endpoint in production
    // For now, we'll use dummy data
    document.getElementById('avgCalories').textContent = '2,150 kcal';
    document.getElementById('mealsLogged').textContent = '18';
    document.getElementById('weightChange').textContent = '-0.5 kg';
    document.getElementById('bmiChange').textContent = '-0.2';
  } catch (error) {
    console.error('Error loading weekly summary:', error);
  }
}

// Calculate streak
function calculateStreak() {
  // This would call an API endpoint in production
  document.getElementById('streakDays').innerHTML = '7<span class="unit">days</span>';
}

// Load all data on page load
document.addEventListener('DOMContentLoaded', () => {
  loadPrediction();
  loadBMIChart(30);
  loadCalorieChart(7);
  loadMacroChart();
  loadWeeklySummary();
  calculateStreak();
});
</script>

<style>
.progress-container {
  max-width: 1400px;
  margin: 0 auto;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 32px;
  flex-wrap: wrap;
  gap: 20px;
}

.header-content h2 {
  font-size: 36px;
  font-weight: 800;
  margin: 0 0 8px;
  color: var(--text);
}

.page-subtitle {
  font-size: 16px;
  color: var(--muted);
  margin: 0;
}

.header-actions {
  display: flex;
  gap: 12px;
}

.btn-export,
.btn-update {
  padding: 10px 20px;
  border-radius: 10px;
  font-weight: 600;
  text-decoration: none;
  transition: all 0.2s ease;
  border: none;
  cursor: pointer;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.btn-export {
  background: white;
  color: var(--text);
  border: 2px solid var(--border);
}

.btn-export:hover {
  border-color: var(--primary);
  color: var(--primary);
  transform: translateY(-2px);
}

.btn-update {
  background: linear-gradient(135deg, var(--primary), var(--primary-600));
  color: white;
  box-shadow: 0 4px 14px rgba(79, 157, 246, 0.3);
}

.btn-update:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(79, 157, 246, 0.4);
}

/* Quick Stats Grid */
.quick-stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 32px;
}

.stat-card {
  background: white;
  border-radius: 16px;
  padding: 24px;
  display: flex;
  align-items: center;
  gap: 16px;
  border: 2px solid var(--border);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--primary), var(--accent));
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
}

.stat-card:hover::before {
  transform: scaleX(1);
}

.stat-card.weight::before { background: linear-gradient(90deg, #4f9df6, #3182ce); }
.stat-card.bmi::before { background: linear-gradient(90deg, #22c55e, #16a34a); }
.stat-card.goal::before { background: linear-gradient(90deg, #f59e0b, #d97706); }
.stat-card.streak::before { background: linear-gradient(90deg, #ef4444, #dc2626); }

.stat-icon {
  font-size: 40px;
  width: 70px;
  height: 70px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, rgba(79, 157, 246, 0.1), rgba(34, 197, 94, 0.1));
  border-radius: 16px;
  flex-shrink: 0;
}

.stat-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.stat-label {
  font-size: 12px;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 700;
}

.stat-value {
  font-size: 32px;
  font-weight: 800;
  color: var(--text);
  line-height: 1;
}

.stat-value .unit {
  font-size: 16px;
  font-weight: 600;
  color: var(--muted);
  margin-left: 4px;
}

.stat-value.bmi-value {
  background: linear-gradient(135deg, #4f9df6, #22c55e);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.stat-change,
.stat-status,
.stat-target,
.stat-message {
  font-size: 13px;
  color: var(--muted);
}

.stat-change.positive {
  color: #22c55e;
  font-weight: 600;
}

.stat-change.negative {
  color: #ef4444;
  font-weight: 600;
}

/* Prediction Card */
.prediction-card {
  background: linear-gradient(135deg, rgba(139, 92, 246, 0.08), rgba(79, 157, 246, 0.08));
  border-left: 4px solid rgb(139, 92, 246);
  margin-bottom: 32px;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 24px;
  flex-wrap: wrap;
  gap: 16px;
}

.header-left h3 {
  margin: 0 0 6px;
  font-size: 22px;
  color: var(--text);
}

.header-left .muted {
  font-size: 14px;
  margin: 0;
}

.confidence-badge {
  padding: 8px 16px;
  border-radius: 20px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  font-weight: 700;
  border: 2px solid;
}

.confidence-badge.high {
  background: rgba(34, 197, 94, 0.1);
  border-color: #22c55e;
  color: #16a34a;
}

.confidence-badge.medium {
  background: rgba(245, 158, 11, 0.1);
  border-color: #f59e0b;
  color: #d97706;
}

.confidence-badge.low {
  background: rgba(239, 68, 68, 0.1);
  border-color: #ef4444;
  color: #dc2626;
}

.badge-label {
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 11px;
}

.badge-value {
  font-size: 16px;
}

/* Loading State */
.loading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  padding: 60px 20px;
  color: var(--muted);
}

.spinner {
  width: 48px;
  height: 48px;
  border: 4px solid rgba(79, 157, 246, 0.2);
  border-top-color: #4f9df6;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Prediction Summary */
.prediction-summary {
  margin-bottom: 32px;
}

.current-status {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
}

.status-card {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 20px;
  background: white;
  border-radius: 12px;
  border: 2px solid var(--border);
  transition: all 0.2s ease;
}

.status-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.status-card.gaining {
  border-color: rgba(239, 68, 68, 0.3);
  background: rgba(239, 68, 68, 0.05);
}

.status-card.losing {
  border-color: rgba(34, 197, 94, 0.3);
  background: rgba(34, 197, 94, 0.05);
}

.status-card.stable {
  border-color: rgba(107, 114, 128, 0.3);
  background: rgba(107, 114, 128, 0.05);
}

.status-icon {
  font-size: 32px;
}

.status-content {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.status-label {
  font-size: 12px;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 700;
}

.status-value {
  font-size: 24px;
  font-weight: 800;
  color: var(--text);
}

.status-value.trend {
  text-transform: capitalize;
}

/* Predictions Timeline */
.predictions-timeline h4 {
  margin: 0 0 20px;
  font-size: 18px;
  color: var(--text);
}

.timeline-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 16px;
}

.prediction-item {
  background: white;
  border: 2px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  transition: all 0.3s ease;
  animation: fadeInUp 0.5s ease both;
  position: relative;
  overflow: hidden;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.prediction-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
}

.prediction-item.underweight::before { background: #fbbf24; }
.prediction-item.normal::before { background: #22c55e; }
.prediction-item.overweight::before { background: #f97316; }
.prediction-item.obese::before { background: #ef4444; }

.prediction-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
}

.prediction-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.pred-timeline {
  display: flex;
  align-items: center;
  gap: 8px;
}

.timeline-dot {
  width: 12px;
  height: 12px;
  background: var(--primary);
  border-radius: 50%;
  border: 2px solid var(--border);
}

.timeline-label {
  font-size: 13px;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 700;
}

.pred-category {
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.pred-category.underweight {
  background: rgba(251, 191, 36, 0.2);
  color: #d97706;
}

.pred-category.normal {
  background: rgba(34, 197, 94, 0.2);
  color: #16a34a;
}

.pred-category.overweight {
  background: rgba(249, 115, 22, 0.2);
  color: #c2410c;
}

.pred-category.obese {
  background: rgba(239, 68, 68, 0.2);
  color: #dc2626;
}

.prediction-body {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

.pred-metric {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.pred-label {
  font-size: 12px;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.pred-value {
  font-size: 24px;
  font-weight: 800;
  color: var(--text);
}

.prediction-footer {
  margin-top: 24px;
  padding: 16px;
  background: rgba(79, 157, 246, 0.08);
  border-radius: 12px;
}

.footer-note {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 14px;
  color: var(--muted);
}

.note-icon {
  font-size: 20px;
}

/* Empty States */
.empty-prediction,
.empty-chart,
.empty-state-nutrition {
  text-align: center;
  padding: 60px 24px;
}

.empty-icon {
  font-size: 64px;
  margin-bottom: 16px;
}

.empty-prediction h4,
.empty-state-nutrition h4 {
  margin: 0 0 12px;
  font-size: 20px;
  color: var(--text);
}

.empty-prediction p,
.empty-chart p,
.empty-state-nutrition p {
  color: var(--muted);
  margin-bottom: 8px;
}

.tip {
  color: var(--primary) !important;
  font-weight: 600;
  margin-top: 12px !important;
}

/* Tabs */
.tabs-container {
  display: flex;
  gap: 8px;
  border-bottom: 2px solid var(--border);
  margin-bottom: 24px;
}

.tab-btn {
  padding: 12px 24px;
  background: transparent;
  border: none;
  border-bottom: 3px solid transparent;
  font-size: 15px;
  font-weight: 600;
  color: var(--muted);
  cursor: pointer;
  transition: all 0.2s ease;
  margin-bottom: -2px;
}

.tab-btn:hover {
  color: var(--text);
  background: rgba(79, 157, 246, 0.05);
}

.tab-btn.active {
  color: var(--primary);
  border-bottom-color: var(--primary);
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

/* Charts */
.charts-card {
  margin-bottom: 32px;
}

.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  flex-wrap: wrap;
  gap: 16px;
}

.chart-header h3 {
  margin: 0;
  font-size: 18px;
  color: var(--text);
}

.chart-controls {
  display: flex;
  gap: 8px;
}

.btn-chart-range {
  padding: 6px 16px;
  border: 2px solid var(--border);
  background: white;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 700;
  color: var(--muted);
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-chart-range:hover {
  border-color: var(--primary);
  color: var(--primary);
  transform: translateY(-1px);
}

.btn-chart-range.active {
  background: var(--primary);
  border-color: var(--primary);
  color: white;
  box-shadow: 0 4px 12px rgba(79, 157, 246, 0.3);
}

.chart-wrapper {
  height: 350px;
  position: relative;
  margin-bottom: 20px;
}

.chart-insights {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  padding: 16px;
  background: rgba(247, 250, 252, 0.5);
  border-radius: 12px;
}

.insight-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  color: var(--text);
}

.insight-icon {
  font-size: 20px;
}

/* Nutrition Section */
.nutrition-overview {
  margin-bottom: 24px;
}

.nutrition-overview h3 {
  margin: 0 0 8px;
  font-size: 20px;
}

.nutrition-overview .muted {
  margin: 0;
  font-size: 14px;
}

.macro-visualization {
  display: grid;
  grid-template-columns: 300px 1fr;
  gap: 32px;
  align-items: center;
}

.macro-chart-container {
  width: 300px;
  height: 300px;
}

.macro-details {
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.macro-item {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.macro-header {
  display: flex;
  align-items: center;
  gap: 12px;
}

.macro-icon {
  font-size: 24px;
}

.macro-name {
  flex: 1;
  font-weight: 700;
  font-size: 16px;
  color: var(--text);
}

.macro-value {
  font-weight: 800;
  font-size: 20px;
  color: var(--primary);
}

.macro-bar {
  height: 20px;
  background: rgba(0, 0, 0, 0.05);
  border-radius: 10px;
  overflow: hidden;
}

.macro-fill {
  height: 100%;
  border-radius: 10px;
  transition: width 0.5s ease;
}

.macro-item.protein .macro-fill {
  background: linear-gradient(90deg, #ef4444, #f87171);
}

.macro-item.carbs .macro-fill {
  background: linear-gradient(90deg, #f59e0b, #fbbf24);
}

.macro-item.fats .macro-fill {
  background: linear-gradient(90deg, #22c55e, #4ade80);
}

.macro-target {
  font-size: 12px;
  color: var(--muted);
  font-style: italic;
}

/* Milestones */
.milestones-card {
  margin-bottom: 32px;
}

.milestones-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 16px;
}

.milestone {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 20px;
  background: white;
  border: 2px solid var(--border);
  border-radius: 12px;
  transition: all 0.2s ease;
  position: relative;
  overflow: hidden;
}

.milestone::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--primary), var(--accent));
}

.milestone.locked {
  opacity: 0.6;
}

.milestone.locked::before {
  background: #e5e7eb;
}

.milestone.unlocked::before {
  background: linear-gradient(90deg, #22c55e, #16a34a);
}

.milestone:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.milestone-icon {
  font-size: 36px;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, rgba(79, 157, 246, 0.1), rgba(34, 197, 94, 0.1));
  border-radius: 12px;
  flex-shrink: 0;
}

.milestone.unlocked .milestone-icon {
  background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
}

.milestone-info {
  flex: 1;
}

.milestone-info h4 {
  margin: 0 0 4px;
  font-size: 16px;
  color: var(--text);
}

.milestone-info p {
  margin: 0;
  font-size: 13px;
  color: var(--muted);
}

.milestone-progress,
.milestone-badge {
  font-size: 18px;
  font-weight: 800;
  padding: 8px 12px;
  background: rgba(79, 157, 246, 0.1);
  border-radius: 8px;
  color: var(--primary);
}

.milestone-badge {
  background: rgba(34, 197, 94, 0.2);
  color: #16a34a;
}

/* Weekly Summary */
.weekly-summary {
  margin-bottom: 32px;
}

.summary-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
}

.summary-item {
  padding: 20px;
  background: linear-gradient(135deg, rgba(79, 157, 246, 0.05), white);
  border-radius: 12px;
  border: 2px solid var(--border);
  transition: all 0.2s ease;
}

.summary-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.summary-metric {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.metric-label {
  font-size: 13px;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 700;
}

.metric-value {
  font-size: 28px;
  font-weight: 800;
  color: var(--text);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 80px 24px;
}

.empty-state h3 {
  margin: 0 0 16px;
  font-size: 28px;
  color: var(--text);
}

.empty-state p {
  color: var(--muted);
  margin-bottom: 32px;
  font-size: 16px;
  max-width: 500px;
  margin-left: auto;
  margin-right: auto;
}

.btn-primary {
  padding: 14px 32px;
  background: linear-gradient(135deg, var(--primary), var(--primary-600));
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 4px 14px rgba(79, 157, 246, 0.3);
  text-decoration: none;
  display: inline-block;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(79, 157, 246, 0.4);
}

.btn-large {
  padding: 16px 40px;
  font-size: 18px;
}

/* Responsive Design */
@media (max-width: 1024px) {
  .macro-visualization {
    grid-template-columns: 1fr;
  }
  
  .macro-chart-container {
    margin: 0 auto;
  }
}

@media (max-width: 768px) {
  .page-header {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .header-actions {
    width: 100%;
    flex-direction: column;
  }
  
  .btn-export,
  .btn-update {
    width: 100%;
    justify-content: center;
  }
  
  .quick-stats-grid {
    grid-template-columns: 1fr;
  }
  
  .current-status {
    grid-template-columns: 1fr;
  }
  
  .timeline-container {
    grid-template-columns: 1fr;
  }
  
  .tabs-container {
    overflow-x: auto;
    scrollbar-width: none;
  }
  
  .tabs-container::-webkit-scrollbar {
    display: none;
  }
  
  .chart-header {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .chart-controls {
    width: 100%;
    justify-content: space-between;
  }
  
  .chart-wrapper {
    height: 280px;
  }
  
  .chart-insights {
    flex-direction: column;
  }
  
  .milestones-grid {
    grid-template-columns: 1fr;
  }
  
  .summary-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 480px) {
  .header-content h2 {
    font-size: 28px;
  }
  
  .stat-value {
    font-size: 24px;
  }
  
  .stat-icon {
    width: 60px;
    height: 60px;
    font-size: 32px;
  }
  
  .btn-chart-range {
    padding: 6px 12px;
    font-size: 12px;
  }
}
</style>
{% endblock %}